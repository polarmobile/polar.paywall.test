<h1>Polar Paywall Tester</h1>

<p>This tool runs tests that will query a publisher's server and check for
incompatibilities with the polar api.</p>

<h2>Installation</h2>

<p>In order to use this tool you will first need to first install python2.5, 2.6
or 2.7. You then need to install setuptools for your respective version of
python.</p>

<p>Once these packages are installed, run the setup.py command:</p>

<pre><code>python setup.py install
</code></pre>

<p>This command will install the source and binaries required to run the tool.</p>

<h3>Windows</h3>

<p>On windows, the tool will be installed under the directory:</p>

<pre><code>C:\Python2.X\Scripts\paywall.test.exe
</code></pre>

<h3>Linux / Mac</h3>

<p>On Mac and Linux, python should install the paywall.test to the system's path.
You will be able to call the utility directly on the command line.</p>

<h2>Usage</h2>

<p>Open a command terminal and be sure you can run the paywall.test script. When
run directly, the script will print out help information. You must first
configure the application before you run it.</p>

<h3>Configuration</h3>

<p>To generate a sample configuration run the command:</p>

<pre><code>paywall.test template
</code></pre>

<p>This command will print the sample configuration to the console. To save it to
a file, run the command:</p>

<pre><code>paywall.test template &gt; config
</code></pre>

<p>Edit the sample configuration. You will need to specify the address of the
server. If the server is running on a different port, you can specify the
port using the following syntax:</p>

<pre><code>address = localhost:8080
</code></pre>

<p>In order to successfully run the tests, you need to specify at a <strong>server</strong>,
a <strong>valid user</strong> and a set of <strong>products</strong> as sections in the configuration.
You may optionally specify an <strong>invalid user</strong> for additional tests.</p>

<h3>Testing</h3>

<p>You have the option of testing the entry points independently or running the
full suite of tests. To run all of the tests use the command:</p>

<pre><code>paywall.test all config
</code></pre>

<p>Where config is the name of the configuration file. By default, the command
will only report violations to the API. You can increase the log level to
get more information on the types of tests being run:</p>

<pre><code>paywall.test all config -l info
</code></pre>

<p>While it is not necessary that all of the tests pass validation, fewer failures
will reduce the chance of failures occurring in production.</p>

<h2>Coverage</h2>

<p>The testing functions try to exercise all of the potential paths expected to
be implemented in the publisher. This section of the readme describes the test
coverage for the various entry points. There are a number of entry points that
cannot be tested and they are noted.</p>

<h3>auth</h3>

<p>The following tests are run on the auth entry point.</p>

<h4>URL</h4>

<h5>Proper API:</h5>

<ul>
<li>Correct Value: paywallproxy</li>
<li>Expected Result: InvalidAPI 404</li>
</ul>

<h5>Correct Version:</h5>

<ul>
<li>Correct Value: v1.0.0</li>
<li>Expected Result: InvalidVersion 404</li>
</ul>

<h5>Correct Format:</h5>

<ul>
<li>Correct Value: json</li>
<li>Expected Result: InvalidFormat 404</li>
</ul>

<h4>Headers</h4>

<h5>Authorization:</h5>

<ul>
<li>Tests:
<ul>
<li>No header.</li>
<li>No token.</li>
<li>Token incorrect.</li>
</ul></li>
<li>Correct Value: PolarPaywallProxyAuthv1.0.0</li>
<li>result = InvalidAuthScheme 400</li>
</ul>

<h4>Body</h4>

<h5>Charset</h5>

<ul>
<li>Tests:
<ul>
<li>Non-utf8 encoded values.</li>
</ul></li>
<li>Expected Result: InternalError 500</li>
</ul>

<h5>Json Encoding</h5>

<ul>
<li>Tests:
<ul>
<li>Correct number of parameters.</li>
</ul></li>
<li>Expected Result: InvalidFormat 400</li>
</ul>

<h5>device:</h5>

<ul>
<li>Tests:
<ul>
<li>device not in body.</li>
<li>Is an object.</li>
<li>manufacturer not in device.</li>
<li>manufacturer not a string.</li>
<li>model not in device.</li>
<li>model not a string.</li>
<li>os_version not in device.</li>
<li>os_version not a string.</li>
</ul></li>
<li>Expected Result: InvalidDevice 400</li>
</ul>

<h5>auth_params</h5>

<ul>
<li>Tests:
<ul>
<li>Not an object.</li>
<li>Values not strings.</li>
</ul></li>
<li>Expected Result: InvalidAuthParams 400 </li>
</ul>

<h4>Model</h4>

<h5>Invalid username</h5>

<ul>
<li>Expected Result: InvalidPaywallCredentials 401</li>
</ul>

<h5>Invalid password</h5>

<ul>
<li>Expected Result: InvalidPaywallCredentials 401</li>
</ul>

<h5>Invalid account</h5>

<ul>
<li>Expected Result: AccountProblem 403</li>
</ul>

<h5>Invalid product</h5>

<ul>
<li>Expected Result: InvalidProduct 404</li>
</ul>

<h3>session</h3>

<h4>URL</h4>

<h5>Proper API:</h5>

<ul>
<li>Correct Value: paywallproxy</li>
<li>Expected Result: InvalidAPI 404</li>
</ul>

<h5>Correct Version:</h5>

<ul>
<li>Correct Value: v1.0.0</li>
<li>Expected Result: InvalidVersion 404</li>
</ul>

<h5>Correct Format:</h5>

<ul>
<li>Correct Value: json</li>
<li>Expected Result: InvalidFormat 404</li>
</ul>

<h4>Headers</h4>

<h5>Authorization:</h5>

<ul>
<li>Tests:
<ul>
<li>No header.</li>
<li>No token.</li>
<li>Token incorrect.</li>
</ul></li>
<li>Correct Value: PolarPaywallProxySessionv1.0.0 session:<session id></li>
<li>result = InvalidAuthScheme 400</li>
</ul>

<h4>Body</h4>

<ul>
<li>Tests:
<ul>
<li>Providing a body.</li>
</ul></li>
<li>Correct Value: No body.</li>
<li>Expected Result: InternalError 500</li>
</ul>

<h4>Model</h4>

<h5>Invalid Account</h5>

<ul>
<li>Cannot be tested.
<ul>
<li>Invalid accounts cannot authenticate, so the test will never have a valid session id.</li>
</ul></li>
<li>Expected Result: AccountProblem 403</li>
</ul>

<h5>Invalid Product</h5>

<ul>
<li>Expected Result: InvalidProduct 404</li>
</ul>

<h5>Expired Session</h5>

<ul>
<li>Cannot be tested.
<ul>
<li>Timeout values may be very long, so waiting isn't an option.</li>
</ul></li>
<li>Expected Result: SessionExpired 401</li>
</ul>
